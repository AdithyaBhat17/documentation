(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{104:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return p})),n.d(t,"default",(function(){return u}));var o=n(3),r=n(7),a=(n(0),n(411)),s=n(415),c=n(416),i={title:"protobuf",type:"processor",status:"beta",categories:["Parsing"]},l={unversionedId:"components/processors/protobuf",id:"components/processors/protobuf",isDocsHomePage:!1,title:"protobuf",description:"\x3c!--",source:"@site/docs/components/processors/protobuf.md",slug:"/components/processors/protobuf",permalink:"/docs/components/processors/protobuf",editUrl:"https://github.com/Jeffail/benthos/edit/master/website/docs/components/processors/protobuf.md",version:"current",sidebar:"docs",previous:{title:"parse_log",permalink:"/docs/components/processors/parse_log"},next:{title:"rate_limit",permalink:"/docs/components/processors/rate_limit"}},p=[{value:"Operators",id:"operators",children:[{value:"<code>to_json</code>",id:"to_json",children:[]},{value:"<code>from_json</code>",id:"from_json",children:[]}]},{value:"Fields",id:"fields",children:[{value:"<code>operator</code>",id:"operator",children:[]},{value:"<code>message</code>",id:"message",children:[]},{value:"<code>import_path</code>",id:"import_path",children:[]},{value:"<code>parts</code>",id:"parts",children:[]}]},{value:"Examples",id:"examples",children:[]}],b={toc:p};function u(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"BETA: This component is mostly stable but breaking changes could still be made outside of major version releases if a fundamental problem with the component is found."),Object(a.b)("p",null,"Performs conversions to or from a protobuf message. This processor uses\nreflection, meaning conversions can be made directly from the target .proto\nfiles."),Object(a.b)(s.a,{defaultValue:"common",values:[{label:"Common",value:"common"},{label:"Advanced",value:"advanced"}],mdxType:"Tabs"},Object(a.b)(c.a,{value:"common",mdxType:"TabItem"},Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-yaml"}),'# Common config fields, showing default values\nprotobuf:\n  operator: to_json\n  message: ""\n  import_path: ""\n'))),Object(a.b)(c.a,{value:"advanced",mdxType:"TabItem"},Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-yaml"}),'# All config fields, showing default values\nprotobuf:\n  operator: to_json\n  message: ""\n  import_path: ""\n  parts: []\n')))),Object(a.b)("p",null,"The main functionality of this processor is to map to and from JSON documents,\nyou can read more about JSON mapping of protobuf messages here:\n",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://developers.google.com/protocol-buffers/docs/proto3#json"}),"https://developers.google.com/protocol-buffers/docs/proto3#json")),Object(a.b)("p",null,"Using reflection for processing protobuf messages in this way is less performant\nthan generating and using native code. Therefore when performance is critical it\nis recommended that you use Benthos plugins instead for processing protobuf\nmessages natively, you can find an example of Benthos plugins at\n",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/benthosdev/benthos-plugin-example"}),"https://github.com/benthosdev/benthos-plugin-example")),Object(a.b)("h2",{id:"operators"},"Operators"),Object(a.b)("h3",{id:"to_json"},Object(a.b)("inlineCode",{parentName:"h3"},"to_json")),Object(a.b)("p",null,"Converts protobuf messages into a generic JSON structure. This makes it easier\nto manipulate the contents of the document within Benthos."),Object(a.b)("h3",{id:"from_json"},Object(a.b)("inlineCode",{parentName:"h3"},"from_json")),Object(a.b)("p",null,"Attempts to create a target protobuf message from a generic JSON structure."),Object(a.b)("h2",{id:"fields"},"Fields"),Object(a.b)("h3",{id:"operator"},Object(a.b)("inlineCode",{parentName:"h3"},"operator")),Object(a.b)("p",null,"The ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"#operators"}),"operator")," to execute"),Object(a.b)("p",null,"Type: ",Object(a.b)("inlineCode",{parentName:"p"},"string"),Object(a.b)("br",{parentName:"p"}),"\n","Default: ",Object(a.b)("inlineCode",{parentName:"p"},'"to_json"'),Object(a.b)("br",{parentName:"p"}),"\n","Options: ",Object(a.b)("inlineCode",{parentName:"p"},"to_json"),", ",Object(a.b)("inlineCode",{parentName:"p"},"from_json"),"."),Object(a.b)("h3",{id:"message"},Object(a.b)("inlineCode",{parentName:"h3"},"message")),Object(a.b)("p",null,"The fully qualified name of the protobuf message to convert to/from."),Object(a.b)("p",null,"Type: ",Object(a.b)("inlineCode",{parentName:"p"},"string"),Object(a.b)("br",{parentName:"p"}),"\n","Default: ",Object(a.b)("inlineCode",{parentName:"p"},'""'),"  "),Object(a.b)("h3",{id:"import_path"},Object(a.b)("inlineCode",{parentName:"h3"},"import_path")),Object(a.b)("p",null,"A path to a .proto file, or directory containing all .proto files required for parsing the target message. If left empty the current directory is used."),Object(a.b)("p",null,"Type: ",Object(a.b)("inlineCode",{parentName:"p"},"string"),Object(a.b)("br",{parentName:"p"}),"\n","Default: ",Object(a.b)("inlineCode",{parentName:"p"},'""'),"  "),Object(a.b)("h3",{id:"parts"},Object(a.b)("inlineCode",{parentName:"h3"},"parts")),Object(a.b)("p",null,"An optional array of message indexes of a batch that the processor should apply to.\nIf left empty all messages are processed. This field is only applicable when\nbatching messages ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"/docs/configuration/batching"}),"at the input level"),"."),Object(a.b)("p",null,"Indexes can be negative, and if so the part will be selected from the end\ncounting backwards starting from -1."),Object(a.b)("p",null,"Type: ",Object(a.b)("inlineCode",{parentName:"p"},"array"),Object(a.b)("br",{parentName:"p"}),"\n","Default: ",Object(a.b)("inlineCode",{parentName:"p"},"[]"),"  "),Object(a.b)("h2",{id:"examples"},"Examples"),Object(a.b)(s.a,{defaultValue:"JSON to Protobuf",values:[{label:"JSON to Protobuf",value:"JSON to Protobuf"},{label:"Protobuf to JSON",value:"Protobuf to JSON"}],mdxType:"Tabs"},Object(a.b)(c.a,{value:"JSON to Protobuf",mdxType:"TabItem"},Object(a.b)("p",null,"If we have the following protobuf definition within a directory called ",Object(a.b)("inlineCode",{parentName:"p"},"testing/schema"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-protobuf"}),'syntax = "proto3";\npackage testing;\n\nimport "google/protobuf/timestamp.proto";\n\nmessage Person {\n  string first_name = 1;\n  string last_name = 2;\n  string full_name = 3;\n  int32 age = 4;\n  int32 id = 5; // Unique ID number for this person.\n  string email = 6;\n\n  google.protobuf.Timestamp last_updated = 7;\n}\n')),Object(a.b)("p",null,"And a stream of JSON documents of the form:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'{\n    "firstName": "caleb",\n    "lastName": "quaye",\n    "email": "caleb@myspace.com"\n}\n')),Object(a.b)("p",null,"We can convert the documents into protobuf messages with the following config:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-yaml"}),"pipeline:\n  processors:\n    - protobuf:\n        operator: from_json\n        message: testing.Person\n        import_path: testing/schema\n"))),Object(a.b)(c.a,{value:"Protobuf to JSON",mdxType:"TabItem"},Object(a.b)("p",null,"If we have the following protobuf definition within a directory called ",Object(a.b)("inlineCode",{parentName:"p"},"testing/schema"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-protobuf"}),'syntax = "proto3";\npackage testing;\n\nimport "google/protobuf/timestamp.proto";\n\nmessage Person {\n  string first_name = 1;\n  string last_name = 2;\n  string full_name = 3;\n  int32 age = 4;\n  int32 id = 5; // Unique ID number for this person.\n  string email = 6;\n\n  google.protobuf.Timestamp last_updated = 7;\n}\n')),Object(a.b)("p",null,"And a stream of protobuf messages of the type ",Object(a.b)("inlineCode",{parentName:"p"},"Person"),", we could convert them into JSON documents of the format:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'{\n    "firstName": "caleb",\n    "lastName": "quaye",\n    "email": "caleb@myspace.com"\n}\n')),Object(a.b)("p",null,"With the following config:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-yaml"}),"pipeline:\n  processors:\n    - protobuf:\n        operator: to_json\n        message: testing.Person\n        import_path: testing/schema\n")))))}u.isMDXComponent=!0},411:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return f}));var o=n(0),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),b=p(n),m=o,f=b["".concat(s,".").concat(m)]||b[m]||u[m]||a;return n?r.a.createElement(f,c(c({ref:t},l),{},{components:n})):r.a.createElement(f,c({ref:t},l))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=m;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:o,s[1]=c;for(var l=2;l<a;l++)s[l]=n[l];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},412:function(e,t,n){"use strict";function o(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=o(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=o(e))&&(r&&(r+=" "),r+=t);return r}},413:function(e,t,n){"use strict";var o=n(0),r=n(414);t.a=function(){var e=Object(o.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},414:function(e,t,n){"use strict";var o=n(0),r=Object(o.createContext)(void 0);t.a=r},415:function(e,t,n){"use strict";var o=n(0),r=n.n(o),a=n(413),s=n(412),c=n(56),i=n.n(c),l=37,p=39;t.a=function(e){var t=e.lazy,n=e.block,c=e.defaultValue,b=e.values,u=e.groupId,m=e.className,f=Object(a.a)(),d=f.tabGroupChoices,O=f.setTabGroupChoices,g=Object(o.useState)(c),j=g[0],h=g[1],v=o.Children.toArray(e.children);if(null!=u){var y=d[u];null!=y&&y!==j&&b.some((function(e){return e.value===y}))&&h(y)}var N=function(e){h(e),null!=u&&O(u,e)},w=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(s.a)("tabs",{"tabs--block":n},m)},b.map((function(e){var t=e.value,n=e.label;return r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":j===t,className:Object(s.a)("tabs__item",i.a.tabItem,{"tabs__item--active":j===t}),key:t,ref:function(e){return w.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case p:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case l:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(w,e.target,e)},onFocus:function(){return N(t)},onClick:function(){N(t)}},n)}))),t?Object(o.cloneElement)(v.filter((function(e){return e.props.value===j}))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return Object(o.cloneElement)(e,{key:t,hidden:e.props.value!==j})}))))}},416:function(e,t,n){"use strict";var o=n(3),r=n(0),a=n.n(r);t.a=function(e){var t=e.children,n=e.hidden,r=e.className;return a.a.createElement("div",Object(o.a)({role:"tabpanel"},{hidden:n,className:r}),t)}}}]);