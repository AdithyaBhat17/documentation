(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{134:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return s}));var a=t(3),r=t(7),o=(t(0),t(242)),i={title:"Web Client",sidebar_label:"Web Client"},c={unversionedId:"documentation/channelConfiguration/web",id:"documentation/channelConfiguration/web",isDocsHomePage:!1,title:"Web Client",description:"Authenticate the Users in the Web Widget from the Parent Interface via Session Tokens",source:"@site/docs/documentation/channelConfiguration/web.md",slug:"/documentation/channelConfiguration/web",permalink:"/docs/documentation/channelConfiguration/web",version:"current",sidebar_label:"Web Client",sidebar:"documentation",previous:{title:"Launch your bot across channels!",permalink:"/docs/documentation/channelConfiguration/overview"},next:{title:"Android Chatbot SDK",permalink:"/docs/documentation/channelConfiguration/android"}},l=[],d={toc:l};function s(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},d,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"authenticate-the-users-in-the-web-widget-from-the-parent-interface-via-session-tokens"},"Authenticate the Users in the Web Widget from the Parent Interface via Session Tokens"),Object(o.b)("p",null,"Process:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"In the script of publish your bot, developer can configure to add session tokens."),Object(o.b)("li",{parentName:"ol"},"Based on the session tokens we will receive, we will do a parent interface auth API call."),Object(o.b)("li",{parentName:"ol"},"Based on the response from API, we can start the session with the same UID for user.")),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Place the following script at the end of your ",Object(o.b)("inlineCode",{parentName:"li"},"</body>")," tag")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'<script type="text/javascript">\nwindow.ymConfig = { bot:\u2019botId\u2019, ymAuthenticationToken: { id:"userPin",lang: "lang_code"} };  (function () {var w=window,ic=w.YellowMessenger;\nif("function"===typeof ic)ic("reattach_activator"),ic("update",ymConfig);else{var d=document,i=function()\n{i.c(arguments)};function l(){var e=d.createElement("script");e.type="text/javascript",e.async=!0,\ne.src="https://app.yellowmessenger.com/widget/main.js";var t=d.getElementsByTagName("script")[0];\nt.parentNode.insertBefore(e,t)}i.q=[],i.c=function(e){i.q.push(e)},w.YellowMessenger=i,\nw.attachEvent?w.attachEvent("onload",l):w.addEventListener("load",l,!1)}})();\n<\/script>\n')),Object(o.b)("p",null,"Don't forget to update the Bot ID and User PIN and Language Code in the given code."),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},"Event name 'authenticate' will be received in the bot.")),Object(o.b)("p",null,"On receiving the event, we need to send back the senderId using the below code:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'app.sendEvent({\n               code: "verifiedUser",\n               data: senderId\n           });\n')),Object(o.b)("p",null,"Sample Code for reference:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'if (app.data.event && app.data.event.code === \'authenticate\') {\n   /**check db for userpin => map the app.sender to the userpin\n    *next time when this event is received, check the userpin already has a sender in db,\n    *if yes => fetch the sender id and send it in the event\n    *else => send app.sender in the event */\n   const authenticate = async () => {\n       try {\n           let payloadData = app.data.event.payload\n     /**payload contains the details that were sent in the script using ymAuthenticationToken */\n           try {\n               payloadData = (typeof payloadData === "string") ? JSON.parse(payloadData) : payloadData;\n           } catch (e) { }\n           app.log(payloadData, "payloadData")\n \n           app.USER_PIN = (payloadData.id) ? payloadData.id : false;\n           // let default_language = payloadData.lang;\n           let pattern = /\\b(en|id)\\b/gi;\n           let default_language = (payloadData.lang && (payloadData.lang.match(pattern))) ? payloadData.lang.match(pattern)[0] : (payloadData.lang == "id_code") ? "id" : "en"\n           let query = {\n               "table": "user_pin_sender_id_mapping",\n               "body": {\n                   "query": {\n                       "match": {\n                           "user_pin": app.USER_PIN\n                       }\n                   }\n               }\n           }\n           const dbResult = await app.dataStore.search(query);\n           const dbRecords = app._.get(dbResult, \'hits.hits\', []);\n           let senderId;\n           if (dbRecords.length > 0) {\n               senderId = dbRecords[0]._source[\'sender_id\'];\n               let id = dbRecords[0]._id;\n               app.dataStore.update({\n                   table: \'user_pin_sender_id_mapping\',\n                   record: {\n                       _id: id,\n                       default_language\n                   }\n               }).then(() => {\n                   app.log("UPDATED");\n               }).catch(() => {\n                   app.log("NOT UPDATED");\n               })\n           } else {\n               // senderId = new Date().getTime();\n               senderId = app.USER_PIN;\n')))}s.isMDXComponent=!0},242:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return f}));var a=t(0),r=t.n(a);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=r.a.createContext({}),s=function(e){var n=r.a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},p=function(e){var n=s(e.components);return r.a.createElement(d.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},b=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=s(t),b=a,f=p["".concat(i,".").concat(b)]||p[b]||u[b]||o;return t?r.a.createElement(f,c(c({ref:n},d),{},{components:t})):r.a.createElement(f,c({ref:n},d))}));function f(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=b;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var d=2;d<o;d++)i[d]=t[d];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);