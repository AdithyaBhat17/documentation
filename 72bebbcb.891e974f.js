(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{241:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return c})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return p}));var i=t(3),a=t(7),r=(t(0),t(411)),o={title:"Migrating to Version 2"},c={unversionedId:"guides/migration/v2",id:"guides/migration/v2",isDocsHomePage:!1,title:"Migrating to Version 2",description:"Benthos version 2 comes with a small number of backwards incompatible changes",source:"@site/docs/guides/migration/v2.md",slug:"/guides/migration/v2",permalink:"/docs/guides/migration/v2",editUrl:"https://github.com/Jeffail/benthos/edit/master/website/docs/guides/migration/v2.md",version:"current",sidebar:"docs",previous:{title:"Streams API",permalink:"/docs/guides/streams_mode/streams_api"},next:{title:"Migrating to Version 3",permalink:"/docs/guides/migration/v3"}},l=[{value:"Configuration",id:"configuration",children:[{value:"Type Inference",id:"type-inference",children:[]},{value:"Field Default Value Changes",id:"field-default-value-changes",children:[]}]},{value:"Service",id:"service",children:[]},{value:"Go API",id:"go-api",children:[{value:"Condition Package Moved",id:"condition-package-moved",children:[]},{value:"Interface Changes",id:"interface-changes",children:[]}]}],s={toc:l};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(i.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Benthos version 2 comes with a small number of backwards incompatible changes\nthat are organised into three sections; ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"#configuration"}),"configuration"),",\n",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"#service"}),"service")," and ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"#go-api"}),"Go API"),"."),Object(r.b)("p",null,"These changes are considered minor and therefore upgrading is not expected to\ncause significant problems for any users."),Object(r.b)("h2",{id:"configuration"},"Configuration"),Object(r.b)("h3",{id:"type-inference"},"Type Inference"),Object(r.b)("p",null,"Version 2 comes with the ability to infer the ",Object(r.b)("inlineCode",{parentName:"p"},"type")," of components in\nconfiguration files whenever the field is omitted. You can read more about this\nbehaviour ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"/docs/configuration/about#concise-configuration"}),"here"),"."),Object(r.b)("p",null,"This feature is not expected to impact the vast majority of users. However,\nthere is one exception where a malformed section containing unused type\nparameters but a missing ",Object(r.b)("inlineCode",{parentName:"p"},"type")," field will be interpreted differently. For\nexample, the following config:"),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-yaml"}),'pipeline:\n  processors:\n  - # type: text\n    text:\n      operator: set\n      value: "delete all your content"\n')),Object(r.b)("p",null,"In V1 would be interpreted as a ",Object(r.b)("inlineCode",{parentName:"p"},"bounds_check")," processor as it is the default\nprocessor type, whereas V2 would infer this to be a ",Object(r.b)("inlineCode",{parentName:"p"},"text")," processor based on\nits fields."),Object(r.b)("h4",{id:"migration-guide"},"Migration Guide"),Object(r.b)("p",null,"Most users should not be impacted by this change, and a config file that is\nvulnerable to the regression would report linting errors in V1."),Object(r.b)("p",null,"You can quickly verify that your configs are interpreted without regression by\ncomparing the output of ",Object(r.b)("inlineCode",{parentName:"p"},"benthos -c ./yourconfig.yaml --print-yaml")," with V1 and\nV2. If they are the same then you are not affected."),Object(r.b)("h3",{id:"field-default-value-changes"},"Field Default Value Changes"),Object(r.b)("p",null,"In version 2 the field ",Object(r.b)("inlineCode",{parentName:"p"},"unsubscribe_on_close")," of the ",Object(r.b)("inlineCode",{parentName:"p"},"nats_stream")," input is now\n",Object(r.b)("inlineCode",{parentName:"p"},"false")," by default."),Object(r.b)("h2",{id:"service"},"Service"),Object(r.b)("p",null,"The recommended way to create plugins for Benthos is outlined in\n",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"https://github.com/benthosdev/benthos-plugin-example"}),"this repository"),".\nTherefore the following experimental plugin related flags have been removed from\nthe service: ",Object(r.b)("inlineCode",{parentName:"p"},"swap-envs"),", ",Object(r.b)("inlineCode",{parentName:"p"},"plugins-dir"),", ",Object(r.b)("inlineCode",{parentName:"p"},"list-input-plugins"),",\n",Object(r.b)("inlineCode",{parentName:"p"},"list-output-plugins"),", ",Object(r.b)("inlineCode",{parentName:"p"},"list-processor-plugins"),", ",Object(r.b)("inlineCode",{parentName:"p"},"list-condition-plugins"),"."),Object(r.b)("p",null,"The flag ",Object(r.b)("inlineCode",{parentName:"p"},"swap-envs")," has also been removed for clarity, as it had no impact on\nJSON reference resolution. If this flag is being used please open an issue and\nit can be reimplemented to be fully compliant."),Object(r.b)("h2",{id:"go-api"},"Go API"),Object(r.b)("h3",{id:"condition-package-moved"},"Condition Package Moved"),Object(r.b)("p",null,"The package ",Object(r.b)("inlineCode",{parentName:"p"},"github.com/Jeffail/benthos/lib/processor/condition")," has been\nchanged to ",Object(r.b)("inlineCode",{parentName:"p"},"github.com/Jeffail/benthos/lib/condition"),". Migrating should be a\nsimple case of applying a find/replace on your codebase:"),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-sh"}),"find . -name \"*.go\" | \\\n  xargs sed -i 's/benthos\\/lib\\/processor\\/condition/benthos\\/lib\\/condition/g'\n")),Object(r.b)("h3",{id:"interface-changes"},"Interface Changes"),Object(r.b)("p",null,"The following interface changes have occurred to core Benthos components:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"types.Cache")," now has ",Object(r.b)("inlineCode",{parentName:"li"},"types.Closable")," embedded."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"types.RateLimit")," now has ",Object(r.b)("inlineCode",{parentName:"li"},"types.Closable")," embedded."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"types.Manager")," has new method ",Object(r.b)("inlineCode",{parentName:"li"},"GetPlugin"),"."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"log.Modular")," has new method ",Object(r.b)("inlineCode",{parentName:"li"},"WithFields"),".")))}p.isMDXComponent=!0},411:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return m}));var i=t(0),a=t.n(i);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=a.a.createContext({}),p=function(e){var n=a.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},b=function(e){var n=p(e.components);return a.a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},u=a.a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),b=p(t),u=i,m=b["".concat(o,".").concat(u)]||b[u]||d[u]||r;return t?a.a.createElement(m,c(c({ref:n},s),{},{components:t})):a.a.createElement(m,c({ref:n},s))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=u;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:i,o[1]=c;for(var s=2;s<r;s++)o[s]=t[s];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);