(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{411:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return b}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},d=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(a),m=n,b=d["".concat(i,".").concat(m)]||d[m]||u[m]||o;return a?r.a.createElement(b,c(c({ref:t},l),{},{components:a})):r.a.createElement(b,c({ref:t},l))}));function b(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,i[1]=c;for(var l=2;l<o;l++)i[l]=a[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"},94:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return c})),a.d(t,"toc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(3),r=a(7),o=(a(0),a(411)),i={title:"Metadata"},c={unversionedId:"configuration/metadata",id:"configuration/metadata",isDocsHomePage:!1,title:"Metadata",description:"In Benthos each message has raw contents and metadata, which is a map of key/value pairs representing an arbitrary amount of complementary data.",source:"@site/docs/configuration/metadata.md",slug:"/configuration/metadata",permalink:"/docs/configuration/metadata",editUrl:"https://github.com/Jeffail/benthos/edit/master/website/docs/configuration/metadata.md",version:"current",sidebar:"docs",previous:{title:"Windowed Processing",permalink:"/docs/configuration/windowed_processing"},next:{title:"Error Handling",permalink:"/docs/configuration/error_handling"}},s=[{value:"Editing Metadata",id:"editing-metadata",children:[]},{value:"Using Metadata",id:"using-metadata",children:[]}],l={toc:s};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"In Benthos each message has raw contents and metadata, which is a map of key/value pairs representing an arbitrary amount of complementary data."),Object(o.b)("p",null,"When an input protocol supports attributes or metadata they will automatically be added to your messages, refer to the respective input documentation for a list of metadata keys. When an output supports attributes or metadata any metadata key/value pairs in a message will be sent (subject to service limits)."),Object(o.b)("h2",{id:"editing-metadata"},"Editing Metadata"),Object(o.b)("p",null,"Benthos allows you to add and remove metadata using the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/components/processors/bloblang"}),Object(o.b)("inlineCode",{parentName:"a"},"bloblang")," processor"),". For example, you can do something like this in your pipeline:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),"pipeline:\n  processors:\n  - bloblang: |\n      # Remove all existing metadata from messages\n      meta = deleted()\n\n      # Add a new metadata field `time` from the contents of a JSON\n      # field `event.timestamp`\n      meta time = event.timestamp\n")),Object(o.b)("p",null,"You can also use ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/guides/bloblang/about"}),"Bloblang")," to delete individual metadata keys with:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-coffee"}),"meta foo = deleted()\n")),Object(o.b)("p",null,"Or do more interesting things like remove all metadata keys with a certain prefix:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-coffee"}),'meta = meta().filter(!this.key.has_prefix("kafka_"))\n')),Object(o.b)("h2",{id:"using-metadata"},"Using Metadata"),Object(o.b)("p",null,"Metadata values can be referenced in any field that supports ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/configuration/interpolation"}),"interpolation functions"),". For example, you can route messages to Kafka topics using interpolation of metadata keys:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),'output:\n  kafka:\n    addresses: [ TODO ]\n    topic: ${! meta("target_topic") }\n')),Object(o.b)("p",null,"Benthos also allows you to conditionally process messages based on their metadata with the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/components/processors/switch"}),Object(o.b)("inlineCode",{parentName:"a"},"switch")," processor"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-yaml"}),'pipeline:\n  processors:\n  - switch:\n    - check: meta("doc_type") == "nested"\n      processors:\n        - sql:\n            driver: mysql\n            dsn: foouser:foopassword@tcp(localhost:3306)/foodb\n            query: "INSERT INTO footable (foo, bar, baz) VALUES (?, ?, ?);"\n            args:\n            - ${! json("document.foo") }\n            - ${! json("document.bar") }\n            - ${! meta("kafka_topic") }\n')),Object(o.b)("p",null,"Or, for more complex branches it might be best to use the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/components/processors/awk"}),Object(o.b)("inlineCode",{parentName:"a"},"awk")," processor"),"."))}p.isMDXComponent=!0}}]);