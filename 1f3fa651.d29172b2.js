(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{108:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(3),o=n(7),r=(n(0),n(408)),i=["components"],c={title:"Use access token directly from API response",sidebar_label:"Use dynamic access token"},s={unversionedId:"platform_concepts/studio/api/bearer-token",id:"platform_concepts/studio/api/bearer-token",isDocsHomePage:!1,title:"Use access token directly from API response",description:"We support different authentication types to ensure you can configure any type of API irrespective of the authentication method. You can use Basic Auth, OAuth, Barer token and more.",source:"@site/docs/platform_concepts/studio/api/bearer-token.md",slug:"/platform_concepts/studio/api/bearer-token",permalink:"/docs/platform_concepts/studio/api/bearer-token",version:"current",sidebar_label:"Use dynamic access token",sidebar:"platform_concepts",previous:{title:"Add Enviroment Variables to API",permalink:"/docs/platform_concepts/studio/api/enviroment-variables"},next:{title:"API Error Alerts and Error Log",permalink:"/docs/platform_concepts/studio/api/api-settings"}},l=[{value:"1. Pass access token in API&#39;s Header",id:"1-pass-access-token-in-apis-header",children:[]},{value:"2. Pass access token in Code function",id:"2-pass-access-token-in-code-function",children:[]}],b={toc:l};function p(e){var t=e.components,n=Object(o.a)(e,i);return Object(r.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"We support different authentication types to ensure you can configure any type of API irrespective of the authentication method. You can use Basic Auth, OAuth, Barer token and more."),Object(r.b)("p",null,"In this article, you will learn - "),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"How to pass access token variables in the API header"),Object(r.b)("li",{parentName:"ol"},"How to use access token variable in the code function")),Object(r.b)("p",null,"This article explains different ways of using access token generated directly from the generate auth token API."),Object(r.b)("h2",{id:"1-pass-access-token-in-apis-header"},"1. Pass access token in API's Header"),Object(r.b)("p",null,"If you do not want to use code function, you can directly pass the access token received in the auth API response and pass it in the Header of another API that you want to authenticate."),Object(r.b)("p",null,"To do so, follow these steps - "),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"In ",Object(r.b)("strong",{parentName:"li"},"Studio")," > ",Object(r.b)("strong",{parentName:"li"},"Build")," > ",Object(r.b)("strong",{parentName:"li"},"API"),"  and ",Object(r.b)("a",{parentName:"li",href:"https://docs.yellow.ai/docs/platform_concepts/studio/api/add-api"},"add a new API")," to fetch the access token."),Object(r.b)("li",{parentName:"ol"},"Copy the access token from the source. ")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Here, we\u2019ve added a salesforce API to create a bearer token. During the course of this tutorial, we\u2019ll call it auth API. This API returns a ",Object(r.b)("strong",{parentName:"p"},"Bearer token")," which we will use in another API for authentication.")),Object(r.b)("p",null,"   ",Object(r.b)("img",{parentName:"p",src:"https://i.imgur.com/zZCcghI.png",alt:null})),Object(r.b)("ol",{start:4},Object(r.b)("li",{parentName:"ol"},"Open the API or ",Object(r.b)("a",{parentName:"li",href:"./add-api"},"add a new API")," to which you want to add access token (Authorization header).")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"In the example, we will be adding a search lead API from Salesforce. Pass the bearer token in the header and email as a ",Object(r.b)("a",{parentName:"p",href:"./send-data"},"parameter to this API"),". So we will fetch values from ",Object(r.b)("a",{parentName:"p",href:"../build/bot-variables"},"variables")," and pass it to the API using this syntax ",Object(r.b)("inlineCode",{parentName:"p"},"{{{variable_name}}}"),"; as shown in the screenshots below.")),Object(r.b)("img",{src:"https://i.imgur.com/HJUtzk7.png",alt:"drawing",width:"80%"}),Object(r.b)("img",{src:"https://i.imgur.com/Xu6yn3O.png",alt:"drawing",width:"80%"}),Object(r.b)("ol",{start:5},Object(r.b)("li",{parentName:"ol"},"Go back to ",Object(r.b)("strong",{parentName:"li"},"Studio")," > ",Object(r.b)("strong",{parentName:"li"},"Build")," > ",Object(r.b)("strong",{parentName:"li"},"Flows")," and "),Object(r.b)("li",{parentName:"ol"},"Create an ",Object(r.b)("a",{parentName:"li",href:"../build/nodes/action-nodes#api"},"API action node")," to invoke auth API and store the response in a custom variable.")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"In the example, create an action node named ",Object(r.b)("inlineCode",{parentName:"p"},"salesforceAuth")," to invoke auth API and store response in ",Object(r.b)("inlineCode",{parentName:"p"},"sf_auth_response")," variable.")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Problem with this API is that most API which requires bearer token authentication requires the token to be in this format ",Object(r.b)("inlineCode",{parentName:"p"},"Bearer TOKEN_HERE"),". Auth API only returns a token without ",Object(r.b)("inlineCode",{parentName:"p"},"Bearer")," prefix. Hence, we can use a ",Object(r.b)("a",{parentName:"p",href:"../build/nodes/action-nodes#variables"},"variable action node")," to add a ",Object(r.b)("inlineCode",{parentName:"p"},"Bearer")," prefix to the token. Create another variable ",Object(r.b)("inlineCode",{parentName:"p"},"auth_token")," and use this syntax to add a prefix ",Object(r.b)("inlineCode",{parentName:"p"},"Bearer {{{variables.sf_auth_response}}}"),"."))),Object(r.b)("p",null,"If the API node goes to fallback,  you can add a text message node and trigger a welcome journey."),Object(r.b)("img",{src:"https://i.imgur.com/3M3NWMe.png",width:"400"}),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"In the example"),Object(r.b)("ul",{parentName:"blockquote"},Object(r.b)("li",{parentName:"ul"},"Create or open a journey where you want to use Salesforce Search API, say ",Object(r.b)("inlineCode",{parentName:"li"},"salesforceSearchLead")," journey. Here, what we want is to first trigger is the ",Object(r.b)("inlineCode",{parentName:"li"},"salesforceauth")," API and store the bearer token in the ",Object(r.b)("inlineCode",{parentName:"li"},"auth_token")," variable which will be used here."),Object(r.b)("li",{parentName:"ul"},"Hence, in this flow,  add a ",Object(r.b)("a",{parentName:"li",href:"../build/nodes/action-nodes#trigger-journey"},"Trigger journey node")," and trigger ",Object(r.b)("inlineCode",{parentName:"li"},"salesforceauth")," flow. Once the ",Object(r.b)("inlineCode",{parentName:"li"},"salesforceauth")," flow is executed, the current ",Object(r.b)("inlineCode",{parentName:"li"},"salesforceSearchLead")," will be executed. Now, in the API action node, select the ",Object(r.b)("inlineCode",{parentName:"li"},"get_lead")," API and under parameters, select ",Object(r.b)("inlineCode",{parentName:"li"},"auth_token")," and ",Object(r.b)("inlineCode",{parentName:"li"},"email")," variables."),Object(r.b)("li",{parentName:"ul"},"Finally, store the response of this API in ",Object(r.b)("inlineCode",{parentName:"li"},"sf_search_lead_response"),".",Object(r.b)("img",{src:"https://i.imgur.com/ijhgh60.png",width:"400"})))),Object(r.b)("h2",{id:"2-pass-access-token-in-code-function"},"2. Pass access token in Code function"),Object(r.b)("p",null,"You can also use the Code function to send token from the generate auth token API and use it in another API that you want to authenticate."),Object(r.b)("p",null,"To do so - "),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Open any journey where you've added API Action Node which invokes auth API.")),Object(r.b)("img",{src:"https://i.imgur.com/sQsTVL9.png",width:"90%"}),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"Add a new function to parse bearer token from the API response. Store the response in a variable, here we'll be storing the response in ",Object(r.b)("inlineCode",{parentName:"li"},"auth")," variable.")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Function: getAuthToken")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'let { apiResponse } = ymLib.args; // retrieve API response\nlet  token = JSON.parse(apiResponse.body);\n\nconsole.log(token);\n\nreturn  token.token_type + " " + token.access_token;\n')),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"Open the API where you need to pass the bearer token and pass the token using this syntax: ",Object(r.b)("inlineCode",{parentName:"li"},"{{{variable_name}}}"),".")),Object(r.b)("p",null,"Here we need to pass the bearer token under headers, so click on ",Object(r.b)("inlineCode",{parentName:"p"},"Add Headers")," and enter this text: ",Object(r.b)("inlineCode",{parentName:"p"},"{{{auth_token}}}"),"."),Object(r.b)("img",{src:"https://i.imgur.com/wadPMWR.png",alt:"drawing",width:"50%"}),Object(r.b)("ol",{start:4},Object(r.b)("li",{parentName:"ol"},"To try this workflow, try invoking the journey where you're using the auth API. \ud83d\ude80")),Object(r.b)("hr",null),Object(r.b)("h4",{id:"what-next"},"What next?"),Object(r.b)("blockquote",null,Object(r.b)("ul",{parentName:"blockquote"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"/docs/platform_concepts/studio/api/send-data"},"Know how to send data to the API")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"/docs/platform_concepts/studio/api/api-settings"},"Monitor errors in APIs")))))}p.isMDXComponent=!0},408:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),b=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=b(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=b(n),d=a,h=p["".concat(i,".").concat(d)]||p[d]||u[d]||r;return n?o.a.createElement(h,c(c({ref:t},l),{},{components:n})):o.a.createElement(h,c({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var l=2;l<r;l++)i[l]=n[l];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);