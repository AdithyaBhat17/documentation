(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{242:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return u})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return b}));var a=n(3),r=n(7),i=(n(0),n(411)),o=n(415),c=n(416),s={title:"read_until",type:"input",status:"stable",categories:["Utility"]},u={unversionedId:"components/inputs/read_until",id:"components/inputs/read_until",isDocsHomePage:!1,title:"read_until",description:"\x3c!--",source:"@site/docs/components/inputs/read_until.md",slug:"/components/inputs/read_until",permalink:"/docs/components/inputs/read_until",editUrl:"https://github.com/Jeffail/benthos/edit/master/website/docs/components/inputs/read_until.md",version:"current",sidebar:"docs",previous:{title:"nsq",permalink:"/docs/components/inputs/nsq"},next:{title:"redis_list",permalink:"/docs/components/inputs/redis_list"}},l=[{value:"Metadata",id:"metadata",children:[]},{value:"Fields",id:"fields",children:[{value:"<code>input</code>",id:"input",children:[]},{value:"<code>check</code>",id:"check",children:[]},{value:"<code>restart_input</code>",id:"restart_input",children:[]}]},{value:"Examples",id:"examples",children:[]}],p={toc:l};function b(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"Reads messages from a child input until a consumed message passes a ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/guides/bloblang/about/"}),"Bloblang query"),", at which point the input closes."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'# Config fields, showing default values\ninput:\n  read_until:\n    input: {}\n    check: ""\n    restart_input: false\n')),Object(i.b)("p",null,"Messages are read continuously while the query check returns false, when the query returns true the message that triggered the check is sent out and the input is closed. Use this to define inputs where the stream should end once a certain message appears."),Object(i.b)("p",null,"Sometimes inputs close themselves. For example, when the ",Object(i.b)("inlineCode",{parentName:"p"},"file")," input type reaches the end of a file it will shut down. By default this type will also shut down. If you wish for the input type to be restarted every time it shuts down until the query check is met then set ",Object(i.b)("inlineCode",{parentName:"p"},"restart_input")," to ",Object(i.b)("inlineCode",{parentName:"p"},"true"),"."),Object(i.b)("h3",{id:"metadata"},"Metadata"),Object(i.b)("p",null,"A metadata key ",Object(i.b)("inlineCode",{parentName:"p"},"benthos_read_until")," containing the value ",Object(i.b)("inlineCode",{parentName:"p"},"final")," is added to the first part of the message that triggers the input to stop."),Object(i.b)("h2",{id:"fields"},"Fields"),Object(i.b)("h3",{id:"input"},Object(i.b)("inlineCode",{parentName:"h3"},"input")),Object(i.b)("p",null,"The child input to consume from."),Object(i.b)("p",null,"Type: ",Object(i.b)("inlineCode",{parentName:"p"},"object"),Object(i.b)("br",{parentName:"p"}),"\n","Default: ",Object(i.b)("inlineCode",{parentName:"p"},"{}"),"  "),Object(i.b)("h3",{id:"check"},Object(i.b)("inlineCode",{parentName:"h3"},"check")),Object(i.b)("p",null,"A ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/guides/bloblang/about/"}),"Bloblang query")," that should return a boolean value indicating whether the input should now be closed."),Object(i.b)("p",null,"Type: ",Object(i.b)("inlineCode",{parentName:"p"},"string"),Object(i.b)("br",{parentName:"p"}),"\n","Default: ",Object(i.b)("inlineCode",{parentName:"p"},'""'),"  "),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'# Examples\n\ncheck: this.type == "foo"\n\ncheck: count("messages") >= 100\n')),Object(i.b)("h3",{id:"restart_input"},Object(i.b)("inlineCode",{parentName:"h3"},"restart_input")),Object(i.b)("p",null,"Whether the input should be reopened if it closes itself before the condition has resolved to true."),Object(i.b)("p",null,"Type: ",Object(i.b)("inlineCode",{parentName:"p"},"bool"),Object(i.b)("br",{parentName:"p"}),"\n","Default: ",Object(i.b)("inlineCode",{parentName:"p"},"false"),"  "),Object(i.b)("h2",{id:"examples"},"Examples"),Object(i.b)(o.a,{defaultValue:"Consume N Messages",values:[{label:"Consume N Messages",value:"Consume N Messages"}],mdxType:"Tabs"},Object(i.b)(c.a,{value:"Consume N Messages",mdxType:"TabItem"},Object(i.b)("p",null,"A common reason to use this input is to consume only N messages from an input and then stop. This can easily be done with the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/guides/bloblang/functions/#count"}),Object(i.b)("inlineCode",{parentName:"a"},"count")," function"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'# Only read 100 messages, and then exit.\ninput:\n  read_until:\n    check: count("messages") >= 100\n    input:\n      kafka:\n        addresses: [ TODO ]\n        topics: [ foo, bar ]\n        consumer_group: foogroup\n')))))}b.isMDXComponent=!0},411:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r.a.createContext({}),l=function(e){var t=r.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=l(e.components);return r.a.createElement(u.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(n),d=a,m=p["".concat(o,".").concat(d)]||p[d]||b[d]||i;return n?r.a.createElement(m,c(c({ref:t},u),{},{components:n})):r.a.createElement(m,c({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var u=2;u<i;u++)o[u]=n[u];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},412:function(e,t,n){"use strict";function a(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(r&&(r+=" "),r+=t);return r}},413:function(e,t,n){"use strict";var a=n(0),r=n(414);t.a=function(){var e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},414:function(e,t,n){"use strict";var a=n(0),r=Object(a.createContext)(void 0);t.a=r},415:function(e,t,n){"use strict";var a=n(0),r=n.n(a),i=n(413),o=n(412),c=n(56),s=n.n(c),u=37,l=39;t.a=function(e){var t=e.lazy,n=e.block,c=e.defaultValue,p=e.values,b=e.groupId,d=e.className,m=Object(i.a)(),f=m.tabGroupChoices,h=m.setTabGroupChoices,O=Object(a.useState)(c),j=O[0],y=O[1],g=a.Children.toArray(e.children);if(null!=b){var v=f[b];null!=v&&v!==j&&p.some((function(e){return e.value===v}))&&y(v)}var N=function(e){y(e),null!=b&&h(b,e)},w=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(o.a)("tabs",{"tabs--block":n},d)},p.map((function(e){var t=e.value,n=e.label;return r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":j===t,className:Object(o.a)("tabs__item",s.a.tabItem,{"tabs__item--active":j===t}),key:t,ref:function(e){return w.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case l:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case u:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(w,e.target,e)},onFocus:function(){return N(t)},onClick:function(){N(t)}},n)}))),t?Object(a.cloneElement)(g.filter((function(e){return e.props.value===j}))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},g.map((function(e,t){return Object(a.cloneElement)(e,{key:t,hidden:e.props.value!==j})}))))}},416:function(e,t,n){"use strict";var a=n(3),r=n(0),i=n.n(r);t.a=function(e){var t=e.children,n=e.hidden,r=e.className;return i.a.createElement("div",Object(a.a)({role:"tabpanel"},{hidden:n,className:r}),t)}}}]);