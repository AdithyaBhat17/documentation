(window.webpackJsonp=window.webpackJsonp||[]).push([[223],{300:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return s}));var a=n(3),o=n(7),r=(n(0),n(411)),c=(n(415),n(416),{title:"Bloblang Functions",sidebar_label:"Functions",description:"A list of Bloblang functions"}),i={unversionedId:"guides/bloblang/functions",id:"guides/bloblang/functions",isDocsHomePage:!1,title:"Bloblang Functions",description:"A list of Bloblang functions",source:"@site/docs/guides/bloblang/functions.md",slug:"/guides/bloblang/functions",permalink:"/docs/guides/bloblang/functions",editUrl:"https://github.com/Jeffail/benthos/edit/master/website/docs/guides/bloblang/functions.md",version:"current",sidebar_label:"Functions",sidebar:"docs",previous:{title:"Bloblang",permalink:"/docs/guides/bloblang/about"},next:{title:"Bloblang Methods",permalink:"/docs/guides/bloblang/methods"}},l=[{value:"General",id:"general",children:[{value:"<code>count</code>",id:"count",children:[]},{value:"<code>deleted</code>",id:"deleted",children:[]},{value:"<code>range</code>",id:"range",children:[]},{value:"<code>throw</code>",id:"throw",children:[]},{value:"<code>uuid_v4</code>",id:"uuid_v4",children:[]},{value:"<code>random_int</code>",id:"random_int",children:[]}]},{value:"Message Info",id:"message-info",children:[{value:"<code>batch_index</code>",id:"batch_index",children:[]},{value:"<code>batch_size</code>",id:"batch_size",children:[]},{value:"<code>content</code>",id:"content",children:[]},{value:"<code>error</code>",id:"error",children:[]},{value:"<code>errored</code>",id:"errored",children:[]},{value:"<code>json</code>",id:"json",children:[]},{value:"<code>meta</code>",id:"meta",children:[]}]},{value:"Environment",id:"environment",children:[{value:"<code>env</code>",id:"env",children:[]},{value:"<code>file</code>",id:"file",children:[]},{value:"<code>hostname</code>",id:"hostname",children:[]},{value:"<code>now</code>",id:"now",children:[]},{value:"<code>timestamp_unix</code>",id:"timestamp_unix",children:[]},{value:"<code>timestamp_unix_nano</code>",id:"timestamp_unix_nano",children:[]}]},{value:"Deprecated",id:"deprecated",children:[{value:"<code>timestamp</code>",id:"timestamp",children:[]},{value:"<code>timestamp_utc</code>",id:"timestamp_utc",children:[]}]}],b={toc:l};function s(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Functions can be placed anywhere and allow you to extract information from your environment, generate values, or access data from the underlying message being mapped:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.doc.id = uuid_v4()\nroot.doc.received_at = now()\nroot.doc.host = hostname()\n")),Object(r.b)("h2",{id:"general"},"General"),Object(r.b)("h3",{id:"count"},Object(r.b)("inlineCode",{parentName:"h3"},"count")),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"count")," function is a counter starting at 1 which increments after each time it is called. Count takes an argument which is an identifier for the counter, allowing you to specify multiple unique counters in your configuration."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root = this\nroot.id = count("bloblang_function_example")\n\n# In:  {"message":"foo"}\n# Out: {"id":1,"message":"foo"}\n\n# In:  {"message":"bar"}\n# Out: {"id":2,"message":"bar"}\n')),Object(r.b)("h3",{id:"deleted"},Object(r.b)("inlineCode",{parentName:"h3"},"deleted")),Object(r.b)("p",null,"A function that returns a result indicating that the mapping target should be deleted."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root = this\nroot.bar = deleted()\n\n# In:  {"bar":"bar_value","baz":"baz_value","foo":"foo value"}\n# Out: {"baz":"baz_value","foo":"foo value"}\n')),Object(r.b)("p",null,"Since the result is a value it can be used to do things like remove elements of an array within ",Object(r.b)("inlineCode",{parentName:"p"},"map_each"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.new_nums = this.nums.map_each(\n  match this {\n    this < 10 => deleted()\n    _ => this - 10\n  }\n)\n\n# In:  {"nums":[3,11,4,17]}\n# Out: {"new_nums":[1,7]}\n')),Object(r.b)("h3",{id:"range"},Object(r.b)("inlineCode",{parentName:"h3"},"range")),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"range")," function creates an array of integers following a range between a start, stop and optional step integer argument. If the step argument is omitted then it defaults to 1. A negative step can be provided as long as stop < start."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.a = range(0, 10)\nroot.b = range(0, this.max, 2)\nroot.c = range(0, -this.max, -2)\n\n# In:  {"max":10}\n# Out: {"a":[0,1,2,3,4,5,6,7,8,9],"b":[0,2,4,6,8],"c":[0,-2,-4,-6,-8]}\n')),Object(r.b)("h3",{id:"throw"},Object(r.b)("inlineCode",{parentName:"h3"},"throw")),Object(r.b)("p",null,"Throws an error similar to a regular mapping error. This is useful for abandoning a mapping entirely given certain conditions."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.doc.type = match {\n  this.exists("header.id") => "foo"\n  this.exists("body.data") => "bar"\n  _ => throw("unknown type")\n}\nroot.doc.contents = (this.body.content | this.thing.body)\n\n# In:  {"header":{"id":"first"},"thing":{"body":"hello world"}}\n# Out: {"doc":{"contents":"hello world","type":"foo"}}\n\n# In:  {"nothing":"matches"}\n# Out: Error("failed to execute mapping query at line 1: unknown type")\n')),Object(r.b)("h3",{id:"uuid_v4"},Object(r.b)("inlineCode",{parentName:"h3"},"uuid_v4")),Object(r.b)("p",null,"Generates a new RFC-4122 UUID each time it is invoked and prints a string representation."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.id = uuid_v4()\n")),Object(r.b)("h3",{id:"random_int"},Object(r.b)("inlineCode",{parentName:"h3"},"random_int")),Object(r.b)("p",null,"Generates a non-negative pseudo-random 64-bit integer. An optional integer argument can be provided in order to seed the random number generator."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.first = random_int()\nroot.second = random_int(1)\n")),Object(r.b)("h2",{id:"message-info"},"Message Info"),Object(r.b)("h3",{id:"batch_index"},Object(r.b)("inlineCode",{parentName:"h3"},"batch_index")),Object(r.b)("p",null,"Returns the index of the mapped message within a batch. This is useful for applying maps only on certain messages of a batch."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root = if batch_index() > 0 { deleted() }\n")),Object(r.b)("h3",{id:"batch_size"},Object(r.b)("inlineCode",{parentName:"h3"},"batch_size")),Object(r.b)("p",null,"Returns the size of the message batch."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.foo = batch_size()\n")),Object(r.b)("h3",{id:"content"},Object(r.b)("inlineCode",{parentName:"h3"},"content")),Object(r.b)("p",null,"Returns the full raw contents of the mapping target message as a byte array. When mapping to a JSON field the value should be encoded using the method ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/guides/bloblang/methods#encode"}),Object(r.b)("inlineCode",{parentName:"a"},"encode")),", or cast to a string directly using the method ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/guides/bloblang/methods#string"}),Object(r.b)("inlineCode",{parentName:"a"},"string")),", otherwise it will be base64 encoded by default."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.doc = content().string()\n\n# In:  {"foo":"bar"}\n# Out: {"doc":"{\\"foo\\":\\"bar\\"}"}\n')),Object(r.b)("h3",{id:"error"},Object(r.b)("inlineCode",{parentName:"h3"},"error")),Object(r.b)("p",null,"If an error has occurred during the processing of a message this function returns the reported cause of the error. For more information about error handling patterns read ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/configuration/error_handling"}),"here"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.doc.error = error()\n")),Object(r.b)("h3",{id:"errored"},Object(r.b)("inlineCode",{parentName:"h3"},"errored")),Object(r.b)("p",null,"Returns a boolean value indicating whether an error has occurred during the processing of a message. For more information about error handling patterns read ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/configuration/error_handling"}),"here"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.doc.status = if errored() { 400 } else { 200 }\n")),Object(r.b)("h3",{id:"json"},Object(r.b)("inlineCode",{parentName:"h3"},"json")),Object(r.b)("p",null,"Returns the value of a field within a JSON message located by a ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/configuration/field_paths"}),"dot path")," argument. This function always targets the entire source JSON document regardless of the mapping context."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.mapped = json("foo.bar")\n\n# In:  {"foo":{"bar":"hello world"}}\n# Out: {"mapped":"hello world"}\n')),Object(r.b)("p",null,"The path argument is optional and if omitted the entire JSON payload is returned."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.doc = json()\n\n# In:  {"foo":{"bar":"hello world"}}\n# Out: {"doc":{"foo":{"bar":"hello world"}}}\n')),Object(r.b)("h3",{id:"meta"},Object(r.b)("inlineCode",{parentName:"h3"},"meta")),Object(r.b)("p",null,"Returns the value of a metadata key from a message identified by a key. Values are extracted from the referenced input message and therefore do NOT reflect changes made from within the map."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.topic = meta("kafka_topic")\n')),Object(r.b)("p",null,"The parameter is optional and if omitted the entire metadata contents are returned as a JSON object."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.all_metadata = meta()\n")),Object(r.b)("h2",{id:"environment"},"Environment"),Object(r.b)("h3",{id:"env"},Object(r.b)("inlineCode",{parentName:"h3"},"env")),Object(r.b)("p",null,"Returns the value of an environment variable."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.thing.key = env("key")\n')),Object(r.b)("h3",{id:"file"},Object(r.b)("inlineCode",{parentName:"h3"},"file")),Object(r.b)("p",null,"BETA: This function is mostly stable but breaking changes could still be made outside of major version releases if a fundamental problem with it is found."),Object(r.b)("p",null,"Reads a file and returns its contents. Relative paths are resolved from the directory of the process executing the mapping."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.doc = file(env("BENTHOS_TEST_BLOBLANG_FILE")).parse_json()\n\n# In:  {}\n# Out: {"doc":{"foo":"bar"}}\n')),Object(r.b)("h3",{id:"hostname"},Object(r.b)("inlineCode",{parentName:"h3"},"hostname")),Object(r.b)("p",null,"Returns a string matching the hostname of the machine running Benthos."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.thing.host = hostname()\n")),Object(r.b)("h3",{id:"now"},Object(r.b)("inlineCode",{parentName:"h3"},"now")),Object(r.b)("p",null,"Returns the current timestamp as a string in ISO 8601 format with the local timezone. Use the method ",Object(r.b)("inlineCode",{parentName:"p"},"format_timestamp")," in order to change the format and timezone."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.received_at = now()\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.received_at = now().format_timestamp("Mon Jan 2 15:04:05 -0700 MST 2006", "UTC")\n')),Object(r.b)("h3",{id:"timestamp_unix"},Object(r.b)("inlineCode",{parentName:"h3"},"timestamp_unix")),Object(r.b)("p",null,"Returns the current unix timestamp in seconds."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.received_at = timestamp_unix()\n")),Object(r.b)("h3",{id:"timestamp_unix_nano"},Object(r.b)("inlineCode",{parentName:"h3"},"timestamp_unix_nano")),Object(r.b)("p",null,"Returns the current unix timestamp in nanoseconds."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),"root.received_at = timestamp_unix_nano()\n")),Object(r.b)("h2",{id:"deprecated"},"Deprecated"),Object(r.b)("h3",{id:"timestamp"},Object(r.b)("inlineCode",{parentName:"h3"},"timestamp")),Object(r.b)("p",null,"Returns the current time in a custom format specified by the argument. The format is defined by showing how the reference time, defined to be ",Object(r.b)("inlineCode",{parentName:"p"},"Mon Jan 2 15:04:05 -0700 MST 2006")," would be displayed if it were the value."),Object(r.b)("p",null,"A fractional second is represented by adding a period and zeros to the end of the seconds section of layout string, as in ",Object(r.b)("inlineCode",{parentName:"p"},"15:04:05.000")," to format a time stamp with millisecond precision. This has been deprecated in favour of the new ",Object(r.b)("inlineCode",{parentName:"p"},"now")," function."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.received_at = timestamp("15:04:05")\n')),Object(r.b)("h3",{id:"timestamp_utc"},Object(r.b)("inlineCode",{parentName:"h3"},"timestamp_utc")),Object(r.b)("p",null,"The equivalent of ",Object(r.b)("inlineCode",{parentName:"p"},"timestamp")," except the time is printed as UTC instead of the local timezone. This has been deprecated in favour of the new ",Object(r.b)("inlineCode",{parentName:"p"},"now")," function."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-coffee"}),'root.received_at = timestamp_utc("15:04:05")\n')))}s.isMDXComponent=!0},411:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var b=o.a.createContext({}),s=function(e){var t=o.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return o.a.createElement(b.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},p=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),d=s(n),p=a,m=d["".concat(c,".").concat(p)]||d[p]||u[p]||r;return n?o.a.createElement(m,i(i({ref:t},b),{},{components:n})):o.a.createElement(m,i({ref:t},b))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,c=new Array(r);c[0]=p;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var b=2;b<r;b++)c[b]=n[b];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},412:function(e,t,n){"use strict";function a(e){var t,n,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(o&&(o+=" "),o+=n);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}t.a=function(){for(var e,t,n=0,o="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(o&&(o+=" "),o+=t);return o}},413:function(e,t,n){"use strict";var a=n(0),o=n(414);t.a=function(){var e=Object(a.useContext)(o.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},414:function(e,t,n){"use strict";var a=n(0),o=Object(a.createContext)(void 0);t.a=o},415:function(e,t,n){"use strict";var a=n(0),o=n.n(a),r=n(413),c=n(412),i=n(56),l=n.n(i),b=37,s=39;t.a=function(e){var t=e.lazy,n=e.block,i=e.defaultValue,d=e.values,u=e.groupId,p=e.className,m=Object(r.a)(),f=m.tabGroupChoices,h=m.setTabGroupChoices,O=Object(a.useState)(i),g=O[0],j=O[1],v=a.Children.toArray(e.children);if(null!=u){var N=f[u];null!=N&&N!==g&&d.some((function(e){return e.value===N}))&&j(N)}var y=function(e){j(e),null!=u&&h(u,e)},_=[];return o.a.createElement("div",null,o.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(c.a)("tabs",{"tabs--block":n},p)},d.map((function(e){var t=e.value,n=e.label;return o.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":g===t,className:Object(c.a)("tabs__item",l.a.tabItem,{"tabs__item--active":g===t}),key:t,ref:function(e){return _.push(e)},onKeyDown:function(e){!function(e,t,n){switch(n.keyCode){case s:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case b:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(_,e.target,e)},onFocus:function(){return y(t)},onClick:function(){y(t)}},n)}))),t?Object(a.cloneElement)(v.filter((function(e){return e.props.value===g}))[0],{className:"margin-vert--md"}):o.a.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return Object(a.cloneElement)(e,{key:t,hidden:e.props.value!==g})}))))}},416:function(e,t,n){"use strict";var a=n(3),o=n(0),r=n.n(o);t.a=function(e){var t=e.children,n=e.hidden,o=e.className;return r.a.createElement("div",Object(a.a)({role:"tabpanel"},{hidden:n,className:o}),t)}}}]);