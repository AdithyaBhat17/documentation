(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{411:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),u=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=u(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,h=p["".concat(s,".").concat(m)]||p[m]||b[m]||a;return n?o.a.createElement(h,c(c({ref:t},l),{},{components:n})):o.a.createElement(h,c({ref:t},l))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,s=new Array(a);s[0]=m;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var l=2;l<a;l++)s[l]=n[l];return o.a.createElement.apply(null,s)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},90:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return i})),n.d(t,"default",(function(){return u}));var r=n(3),o=n(7),a=(n(0),n(411)),s={title:"Resources"},c={unversionedId:"configuration/resources",id:"configuration/resources",isDocsHomePage:!1,title:"Resources",description:"A Benthos configuration file has an optional section called resources, in which it's possible to specify one or more named instances of inputs, caches, processors, rate limits and outputs. When components are declared as a resource they can be referenced by their name throughout your configuration. Only one instance of each named resource is created, but it is safe to use it in multiple places as they can be shared without consequence.",source:"@site/docs/configuration/resources.md",slug:"/configuration/resources",permalink:"/docs/configuration/resources",editUrl:"https://github.com/Jeffail/benthos/edit/master/website/docs/configuration/resources.md",version:"current",sidebar:"docs",previous:{title:"Configuration",permalink:"/docs/configuration/about"},next:{title:"Message Batching",permalink:"/docs/configuration/batching"}},i=[{value:"Reusability",id:"reusability",children:[]},{value:"Feature Toggling",id:"feature-toggling",children:[{value:"With Environment Variables",id:"with-environment-variables",children:[]},{value:"With Imports",id:"with-imports",children:[]}]}],l={toc:i};function u(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"A Benthos configuration file has an optional section called ",Object(a.b)("inlineCode",{parentName:"p"},"resources"),", in which it's possible to specify one or more named instances of inputs, caches, processors, rate limits and outputs. When components are declared as a resource they can be referenced by their name throughout your configuration. Only one instance of each named resource is created, but it is safe to use it in multiple places as they can be shared without consequence."),Object(a.b)("p",null,"Some components such as caches and rate limits can ",Object(a.b)("em",{parentName:"p"},"only")," be created as a resource. However, for components where it's optional there are a few reasons why it might be advantageous to do so."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),"input:\n  resource: foo\n\npipeline:\n  processors:\n    - resource: bar\n    - cache:\n        operator: set\n        resource: baz\n        key: ${! json(\"id\") }\n        value: ${! content() }\n\noutput:\n  resource: buz\n\nresources:\n  inputs:\n    foo:\n      file:\n        paths: [ ./in.txt ]\n\n  processors:\n    bar:\n      bloblang: 'root = content.lowercase()'\n\n  caches:\n    baz:\n      memory:\n        ttl: 300\n\n  outputs:\n    buz:\n      file:\n        path: ./out.txt\n")),Object(a.b)("h2",{id:"reusability"},"Reusability"),Object(a.b)("p",null,"Sometimes it's necessary to use a rather large component multiple times. Instead of copy/pasting the configuration or using YAML anchors you can define your component as a resource."),Object(a.b)("p",null,'In the following example we want to make an HTTP request with our payloads. Occasionally the payload might get rejected due to garbage within its contents, and so we catch these rejected requests, attempt to "cleanse" the contents and try to make the same HTTP request again. Since the HTTP request component is quite large (and likely to change over time) we make sure to avoid duplicating it by defining it as a resource ',Object(a.b)("inlineCode",{parentName:"p"},"get_foo"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'pipeline:\n  processors:\n    - resource: get_foo\n    - catch:\n      - bloblang: |\n          root = this\n          root.content = this.content.strip_html()\n      - resource: get_foo\n\nresources:\n  processors:\n    get_foo:\n      http:\n        url: http://example.com/foo\n        verb: POST\n        headers:\n          SomeThing: "set-to-this"\n          SomeThingElse: "set-to-something-else"\n')),Object(a.b)("h2",{id:"feature-toggling"},"Feature Toggling"),Object(a.b)("h3",{id:"with-environment-variables"},"With Environment Variables"),Object(a.b)("p",null,"There are two ways of using resources for feature toggling, the first is to define your feature components with unique names and then apply the old switcheroo with environment variables to select the one you wish to execute:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'pipeline:\n  processors:\n    - resource: ${ FEATURE_REQUEST }\n\nresources:\n  processors:\n    get_foo:\n      http:\n        url: http://example.com/foo\n        verb: POST\n        headers:\n          SomeThing: "set-to-this"\n          SomeThingElse: "set-to-something-else"\n\n    get_bar:\n      http:\n        url: http://example.com/bar\n        verb: PUT\n        headers:\n          Desires: "are-empty"\n')),Object(a.b)("p",null,"Then when you execute Benthos use the environment variable to choose your resource: ",Object(a.b)("inlineCode",{parentName:"p"},"FEATURE_REQUEST=get_foo benthos -c ./your_config.yaml"),"."),Object(a.b)("h3",{id:"with-imports"},"With Imports"),Object(a.b)("p",null,"However, Benthos allows you to import resources from separate files with the cli flag ",Object(a.b)("inlineCode",{parentName:"p"},"-r")," or ",Object(a.b)("inlineCode",{parentName:"p"},"-resources"),", which can be a useful way to switch out resources with common names based on your chosen environment. For example, with a main configuration file ",Object(a.b)("inlineCode",{parentName:"p"},"config.yaml"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),"pipeline:\n  processors:\n    - resource: get_foo\n")),Object(a.b)("p",null,"And then two resource files, one stored at the path ",Object(a.b)("inlineCode",{parentName:"p"},"./staging/request.yaml"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'resources:\n  processors:\n    get_foo:\n      http:\n        url: http://example.com/foo\n        verb: POST\n        headers:\n          SomeThing: "set-to-this"\n          SomeThingElse: "set-to-something-else"\n')),Object(a.b)("p",null,"And another stored at the path ",Object(a.b)("inlineCode",{parentName:"p"},"./production/request.yaml"),":"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-yaml"}),'resources:\n  processors:\n    get_foo:\n      http:\n        url: http://example.com/bar\n        verb: PUT\n        headers:\n          Desires: "are-empty"\n')),Object(a.b)("p",null,"We can select our chosen resource by changing which file we import, either running:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"benthos -r ./staging/request.yaml -c ./config.yaml\n")),Object(a.b)("p",null,"Or:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"benthos -r ./production/request.yaml -c ./config.yaml\n")),Object(a.b)("p",null,"These flags also support wildcards, which allows you to import an entire directory of resource files like ",Object(a.b)("inlineCode",{parentName:"p"},'benthos -r "./staging/*.yaml" -c ./config.yaml'),"."))}u.isMDXComponent=!0}}]);