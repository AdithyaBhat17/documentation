---
title: Custom Live Agent API Specification
sidebar_label : Custom Live Agent
---


This document elaborates the integration approach for a custom live agent to integrate with Yellow. The major use cases covered in this document are:
1. End Customer wants to talk to an agent
2. End Customer sends Text/Image/Video/PDF ( or other media) to the Agent
3. The interaction details updated to End Customer through the ticket ID & details
4. Additional information about Agent Availability ( Queue Status, Typing status etc)
5. Agent connection established
6. Two Way communication between the end customer and agent
7. Closure of the ticket

## 1. Design Principles

1. The Integration approach is defined to be channel agnostic, the 3rd party system should consider Yellow as the channel and Yellow will ensure that end customer is able to connect to Agent from any channel ( Web, WhatsApp etc.) 
2. Details of the end customer’s channel will be presented to the 3rd party system for proper reconciliation. 
3. The receiving system should be able to define custom parameters for their consumption and as needed for the business use case. 

### 1.1 Workflow Diagram


![](https://i.imgur.com/FCyWNDp.png)


## 2. Business Use Cases

### 2.1 Initiate Conversations 

For an end customer, in the bot experience the following actions take place for connecting to a live agent:

1. Bot gives an option to connect to a Live Agent
2. Bot goes into a paused state once the agent is connect
3. Once the bot is in paused state , the 2-way communication between the agent and end -customer takes place. 
4. Once the agent ends the conversation, the bot takes over. 

The following is the expectation of business use cases to be supported by the 3rd Party Tool for enabling this conversation:



| Use case | Remark | Required |
| -------- | -------- | -------- |
| Send Message {text + media}       | Chat history will be present in the first message as link      | yes     |
|Send typing event||no|
|Create Ticket |Response should contain ticketID: Scenarios ( Ticket Lifecycle) 1. Request is in queue > 2. Ticket is created & OPEN > 3. Ticket is created & ASSIGNED |yes|
|User details {Channel ID, Sender ID, Unique ID}||yes|
|Transfer to a particular group|Department wise, as per business need|no|
|Ability to pass custom parameter||yes|
|Is User Active ||no|
|Custom Parameters|Ability to pass custom parameters as per business need|yes|






### 2.2 Enable conversation

The below use cases depict the use cases & details required during a 2-way communication between the 3rd party system & Yellow.

:::note
For this, Yellow’s webhook must be configured at 3rd party systems end.
:::

| Use case | Remark | Required |
| -------- | -------- | -------- |
|Event name/code specification||yes|
|Agent message {text + media}||yes|
|Agent assigned{along with agent details}|Agent details should be received; like agent name, department|yes|
|Queue Positioning||no|
|Closed ticket|Closed ticket event|yes|
|Updation of any ticket detail (e.g. transferred to another agent)||no|
|Is Agent active?||no|


---


## 3. API Specification

The header that will be common across all the APIs which the third party needs to create is an auth token:-

```
Authorization: {{token}}
Content-type: application/json
```

### 3.1 Create Ticket 

|URL|https://{{domainName}}/createTicket/{{companyName}}|
|---|---|
|METHOD|POST|


#### Body Parameters

|Name|Data type|Description|Mandatory|
|---|---|---|---|
|senderId|string|Unique identifier of the user generated by Yellow.AI|Y|
|messageId|string|Unique identifier of every message sent|Y|
|source|string|Channel from where the message can be sent|Y|
|conversationId|string|Unique identifier of this conversation|Y|
|userName|string|Name of the user/customer|Y|
|userMobile|string|Mobile number of the user. Accepts 10 digit mobile number|Y|
|userEmail|string|Email Id of the user|Y|
|conversationHistory|string|The URL of the conversation prior to connecting to agent|Y|
|ticketPriority|string|Priority of the ticket. Possible values low/medium/high|Y|
|ticketCategory|string|Category to which a ticket may belong|N|
|ticketGroupId|string|If we want the ticket to get assigned to a particular group of agents, then we need to add this|N|
|customFields|object|If any custom key value pairs need to be passed, we need to use this. The data type of the values can be either string/number/boolean/object|N|




#### CURL

```
curl --location --request POST 'https://{{domainName}}/createTicket/{{companyName}}' \
--header 'Authorization: Bearer {{token}}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "body": {
        "user": {
            "userName": "Shubh",
            "userMobile": "99999999",
            "senderId": "11111111211111",
            "userEmail": "test@gmail.com"
        },
        "ticket": {
            "conversationHistory": "https://google.com",
 	"source": "web",
            "ticketPriority": "medium",
            "ticketCategory": "sales",
            "conversationId": "efrfrfrfr",
            "ticketGroupId":  "14343", 
            "customFields": {}
           }
        }
}'

```

#### Response

```
{
status: success/failure
data: {ticketId: 25633, isAgentAvailable: true/false, isQueued: true/false }
message: <Description of Error/ Success Message>
} 
 
```


### 3.2 Send Message to Agent

|URL|https://{{domainName}}/sendMessage/{{companyName}}|
|---|---|
|METHOD|POST|

#### Body Parameters

|Name|Data type|Description|Mandatory|
|---|---|---|---|
|senderId|string|Unique identifier of the user generated by Yellow.ai|Y|
|message|string|Message sent by the user|Y|
|messageId|string|Unique identifier of every message sent|Y|
|ticketId|string|Generated ticketId from API 1|Y|
|source|string|Channel from where the message can be sent|Y|
|conversationId|string|Unique identifier of this conversation|Y|
|messageType|string|Type of the message sent. The value will be text|Y|



#### CURL

```
curl --location --request POST 'https://{{domainName}}/sendMessage/{{companyName}}' \
--header 'Authorization: Bearer {{token}}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "body": {
        “user”:{
         “senderId”: “11111”
         }
        "ticket": {
           “messageType”: “text”,
            “message”: “hello”
            “messageId”: “efefe-eefe-fefef-feefefe”,
            “ticketId”: “275333”,
             “source”: “web”,
            “conversationId” : “yguyegdee”
           }
        }
}'

```
#### Response


```
{
“status”: “success/failure”
“data”: {ticketId: 25633}
“message”: “<Description of Error/ Success Message>”
}

```


### 3.3 Send User Media to Agent

|URL|https://{{domainName}}/sendMedia/{{companyName}}|
|---|---|
|METHOD|POST|


#### Body Parameters

|Name|Data type|Description|Mandatory|
|---|---|---|---|
|senderId|string|Unique identifier of the user generated by Yellow.AI|Y|
|mediaJson|object|Has two properties. The first property is “type”, and its possible values are image/video/file, the second property is “url”, which will have the url of the media|Y|
|messageId|string|Unique identifier of every message sent|Y|
|ticketId|number|Generated ticketId from API 1|Y|
|source|string|Channel from where the message can be sent|Y|
|conversationId|string|Unique identifier of this conversation|Y|
|messageType|string|Type of the message sent. The value will be media|Y|





#### CURL

```
curl --location --request POST 'https://{{domainName}}/sendMedia/{{companyName}}' \
--header 'Authorization: Bearer {{token}}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "body": {
        “user”:{
         “senderId”: “11111”
         }
        "ticket": {
           “messageType”: “media”,
            “mediaJson”: {“type”:”image/video/file”,“url”: “https://image.com”},
            “messageId”: “efefe-eefe-fefef-feefefe”,
            “ticketId”: “275333”,
             “source”: “web”,
            “conversationId” : “yguyegdee”
           }
        }
}'


```

#### Response

```
{
“status”: “success/failure”,
“data”: {ticketId: 25633}
“message”: “<Description of Error/ Success Message>”
}

```

## 4. Webhook

| URL  | https://{{domainName}}/sendMedia/{{companyName}} |
| ---- | -------- |
| Method | POST     |
|x-auth-token|Will be provided by yellow|
|Response Code|200|


### 4.1 Text Message Sent by Agent 

**Event**
- Text message sent by agent

**Payload**
```
{
"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "payload-received-from-agent"
"message": {
"type": "text”,
"payLoad": {
"content": "Hello"
}
}
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454
}

```
**Response**

```
{
“status”: “success”,
data: {"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "payload-received-from-agent"
"message": {
"type": "text”,
"payLoad": {
"content": "Hello"
}
}
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454
}
},
message: <Description of Error/ Success Message>
}

```

### 4.2 Media message sent by the Agent  

**Event**
- Media message sent by the Agent 


**Payload**
```
{
"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "payload-received-from-agent"
"message": {
"type": "media",
"payLoad": {
"content": {“type”: “image/video/file”, “mediaUrl”: “https://www.google.com”}
}
}
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454
}


```

**Response**
```
{
status: success
data: {"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "payload-received-from-agent"
"message": {
"type": "media”,
"payLoad": {
"content": {“type”: “image/video/file”, “mediaUrl”: “https://www.google.com”}
}
}
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454
}
},
message: <Description of Error/ Success Message>
}


```


### 4.3 Ticket Assignment to Agent 

**Event**
- Ticket Assignment to Agent 


**Payload**
```
{
"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "ticket-assigned"
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454
}

```
**Response**

```
{
status: success
data: {"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "ticket-assigned"
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454
}
message: <Description of Error/ Success Message>
}

```

### 4.4 Closure of ticket

**Event**
- Closure of ticket


**Payload**

```
{
"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "ticket-closed"
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454,
"ticketResolvedTime": 4545454
}

```
**Response**
```
{
status: success
data: {
"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "ticket-closed"
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454,
"ticketResolvedTime": 4545454}
message: <Description of Error/ Success Message>
}

```


### 4.5 Agent Logout during the conversation (After Working hours) 

**Event**
- Agent Logout during the conversation (After Working hours)


**Payload**
```
{
"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "agent-logout"
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454
}

```
**Response**
```
{
status: success
data: {"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "agent-logout"
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454}
message: <Description of Error/ Success Message>
}

```


### 4.6. Agent Logged In but not active in Conversation 

**Event**
- Agent Logged In but not active in Conversation 


**Payload**

```
{
"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "agent-inactivity"
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454,
"inactivityDuration": 120,
"inactivityReason": "Network issue"
}

```
**Response**

```
{
status: success/failure
data: {"ticketId": 354545,
"senderId": "efrf",
"source": "erfr4rf4"
"event": "agent-inactivity"
"agentName": "gefgeuf",
"agentId": "locobuzzagentId",
"ticketAssignedTime": 3545454,
"inactivityDuration": 120,
"inactivityReason": "Network issue"}
message: <Description of Error/ Success Message>
}

```





